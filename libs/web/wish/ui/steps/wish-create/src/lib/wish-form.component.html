@let formState = wishForm();

<ng-container *transloco="let t; read: 'wishcreate'">
  <div class="wish-create-container">
    <form
      tuiForm="m"
      class="wish-form"
      (submit)="onSubmit(); $event.preventDefault()"
    >
      <div class="form-split-layout">
        <!-- Left Column: Form Fields -->
        <div class="form-left-column">
          <!-- Title Field -->
          <div class="form-field">
            <label tuiLabel>
              {{ t('form.title.label') }}<span class="tui-required"></span>
              <tui-textfield tuiTextfieldSize="m" [tuiTextfieldCleaner]="true">
                <input
                  tuiInput
                  [placeholder]="t('form.title.placeholder')"
                  [field]="formState.title"
                />
              </tui-textfield>
            </label>
            <wishare-field-error [field]="formState.title" />
          </div>

          <!-- Description Field -->
          <div class="form-field">
            <label tuiLabel>
              {{ t('form.description.label') }}
              <tui-textfield tuiTextfieldSize="m">
                <textarea
                  tuiTextarea
                  [placeholder]="t('form.description.placeholder')"
                  [field]="formState.description"
                ></textarea>
              </tui-textfield>
            </label>
            <wishare-field-error [field]="formState.description" />
          </div>

          <!-- Price and Quantity Row -->
          <div class="form-row">
            <div class="form-field form-field--half">
              <label tuiLabel>
                {{ t('form.price.label') }}
                <tui-textfield tuiTextfieldSize="m">
                  <input
                    tuiInput
                    inputMode="decimal"
                    [placeholder]="t('form.price.placeholder')"
                    [field]="formState.price"
                  />
                </tui-textfield>
              </label>
              <wishare-field-error [field]="formState.price" />
            </div>

            <div class="form-field form-field--half">
              <label tuiLabel>
                {{ t('form.quantity.label') }}
                <tui-textfield tuiTextfieldSize="m">
                  <input
                    tuiInput
                    inputMode="numeric"
                    [placeholder]="t('form.quantity.placeholder')"
                    [field]="formState.quantity"
                  />
                </tui-textfield>
              </label>
              <wishare-field-error [field]="formState.quantity" />
            </div>
          </div>

          <!-- URL Field -->
          <div class="form-field">
            <label tuiLabel>
              {{ t('form.url.label') }}
              <span class="field-hint">
                <tui-icon
                  icon="@tui.info"
                  [tuiTooltip]="t('form.url.hint')"
                ></tui-icon>
              </span>
              <tui-textfield tuiTextfieldSize="m" [tuiTextfieldCleaner]="true">
                <input
                  tuiInput
                  type="url"
                  [placeholder]="t('form.url.placeholder')"
                  [field]="formState.url"
                />
              </tui-textfield>
            </label>
            <wishare-field-error [field]="formState.url" />
          </div>
        </div>

        <!-- Right Column: Image Section -->
        <div class="form-right-column">
          <!-- Image Upload Section -->
          <div class="form-field image-section">
            <label tuiLabel>
              {{ t('form.images.label') }}
              <span class="field-hint">
                <tui-icon
                  icon="@tui.info"
                  [tuiTooltip]="t('form.images.hint')"
                ></tui-icon>
              </span>
            </label>

            <!-- Image Preview Carousel -->
            @if (imagePreviews().length > 0) {
              <div class="image-carousel-container">
                <div class="carousel-wrapper" tuiCarouselButtons>
                  @if (imagePreviews().length > 1) {
                    <button
                      tuiButton
                      tuiIconButton
                      appearance="flat"
                      size="s"
                      iconStart="@tui.chevron-left"
                      type="button"
                      class="carousel-nav carousel-nav--prev"
                      [disabled]="carouselIndex() === 0"
                      (click)="prevImage()"
                    >
                      Previous
                    </button>
                  }

                  <tui-carousel
                    class="image-carousel"
                    [draggable]="true"
                    [(index)]="carouselIndex"
                  >
                    @for (
                      preview of imagePreviews();
                      track preview.id;
                      let i = $index
                    ) {
                      <div *tuiItem class="carousel-slide">
                        <div class="image-preview">
                          <img
                            [src]="preview.dataUrl"
                            [alt]="preview.file?.name || 'Image ' + (i + 1)"
                            class="preview-image"
                            draggable="false"
                          />
                          <button
                            tuiButton
                            tuiIconButton
                            appearance="flat"
                            size="xs"
                            iconStart="@tui.x"
                            type="button"
                            class="remove-image-btn"
                            (click)="removeImage(i)"
                          >
                            Remove
                          </button>
                        </div>
                      </div>
                    }
                  </tui-carousel>

                  @if (imagePreviews().length > 1) {
                    <button
                      tuiButton
                      tuiIconButton
                      appearance="flat"
                      size="s"
                      iconStart="@tui.chevron-right"
                      type="button"
                      class="carousel-nav carousel-nav--next"
                      [disabled]="
                        carouselIndex() === imagePreviews().length - 1
                      "
                      (click)="nextImage()"
                    >
                      Next
                    </button>
                  }
                </div>

                @if (imagePreviews().length > 1) {
                  <tui-pagination
                    size="m"
                    class="image-pagination"
                    [length]="imagePreviews().length"
                    [(index)]="carouselIndex"
                  />
                }

                <div class="image-counter">
                  {{ imageCount() }}/5 {{ t('form.images.counter') }}
                </div>
              </div>
            }

            <!-- File Upload Input -->
            @if (canAddMoreImages()) {
              <label tuiInputFiles class="image-upload-label">
                <input
                  tuiInputFiles
                  type="file"
                  [accept]="acceptedFileTypes"
                  [multiple]="true"
                  [maxFileSize]="maxFileSize"
                  [ngModel]="[]"
                  [ngModelOptions]="{ standalone: true }"
                  (ngModelChange)="onFilesChange($event)"
                  (reject)="onFilesReject($event)"
                />
                <ng-template let-dragged>
                  <div
                    class="upload-content"
                    [class.upload-content--dragged]="dragged"
                  >
                    <div class="upload-icon">
                      <tui-icon
                        [icon]="dragged ? '@tui.image-down' : '@tui.image-plus'"
                      ></tui-icon>
                    </div>
                    <div class="upload-text">
                      @if (dragged) {
                        {{ t('form.images.drop') }}
                      } @else {
                        {{ t('form.images.dragOrClick') }}
                        <a tuiLink>{{ t('form.images.browse') }}</a>
                      }
                    </div>
                    <span class="upload-hint">
                      {{ t('form.images.formats') }}
                    </span>
                  </div>
                </ng-template>
              </label>
            }

            <!-- Rejected Files -->
            @if (rejectedFiles().length > 0) {
              <tui-files class="rejected-files">
                @for (file of rejectedFiles(); track file.name) {
                  <tui-file
                    *tuiItem
                    state="error"
                    [file]="file"
                    (remove)="removeRejectedFile(file)"
                  />
                }
              </tui-files>
            }
          </div>

          <!-- Submit Button in Right Column -->
          <button
            tuiButton
            type="submit"
            appearance="primary"
            size="l"
            class="submit-btn"
            [disabled]="!isValid"
          >
            {{ t('actions.submit') }}
          </button>
        </div>
      </div>

      <!-- Action Buttons (Mobile) -->
      <footer class="dialog-actions dialog-actions--mobile">
        <button
          tuiButton
          type="button"
          appearance="flat"
          size="m"
          (click)="onCancel()"
        >
          {{ t('actions.cancel') }}
        </button>
        <button
          tuiButton
          type="submit"
          appearance="primary"
          size="m"
          iconStart="@tui.plus"
          [disabled]="!isValid"
        >
          {{ t('actions.submit') }}
        </button>
      </footer>
    </form>
  </div>
</ng-container>
