<div class="card" [class.card--reserved]="!isOwner() && isReserved">
  <div
    class="card__image-container"
    [class.card__image-container--clickable]="isOwner()"
    [attr.tabindex]="isOwner() ? 0 : null"
    [attr.role]="isOwner() ? 'button' : null"
    (click)="isOwner() && onEditClick()"
    (keydown.enter)="isOwner() && onEditClick()"
    (keydown.space)="isOwner() && onEditClick(); $event.preventDefault()"
  >
    @if (wish().files?.length) {
    <img
      [src]="getImageUrl(wish().files![0])"
      [alt]="wish().title"
      class="card__image"
    />
    } @else {
    <div class="card__image card__image--placeholder">
      <tui-icon icon="@tui.image" class="placeholder-icon"></tui-icon>
    </div>
    } @if (wish().priority) {
    <span class="card__tag card__tag--{{ getPriorityColor(wish().priority) }}">
      {{ getPriorityLabel(wish().priority) }}
    </span>
    }
    <!-- Reservation badge for non-owners -->
    @if (!isOwner() && isReserved) {
    <span
      class="card__reservation-badge"
      [class.card__reservation-badge--mine]="isReservedByMe()"
    >
      @if (isReservedByMe()) {
      <tui-icon icon="@tui.check" class="badge-icon"></tui-icon>
      Reserved by you } @else {
      <tui-icon icon="@tui.lock" class="badge-icon"></tui-icon>
      Reserved }
    </span>
    }
  </div>

  <div class="card__content">
    <h4
      class="card__title"
      [class.card__title--clickable]="isOwner()"
      [attr.tabindex]="isOwner() ? 0 : null"
      [attr.role]="isOwner() ? 'button' : null"
      (click)="isOwner() && onEditClick()"
      (keydown.enter)="isOwner() && onEditClick()"
      (keydown.space)="isOwner() && onEditClick(); $event.preventDefault()"
    >
      {{ wish().title }}
    </h4>

    @if (wish().description) {
    <p
      class="card__description"
      [class.card__description--clickable]="isOwner()"
      [attr.tabindex]="isOwner() ? 0 : null"
      [attr.role]="isOwner() ? 'button' : null"
      (click)="isOwner() && onEditClick()"
      (keydown.enter)="isOwner() && onEditClick()"
      (keydown.space)="isOwner() && onEditClick(); $event.preventDefault()"
    >
      {{ wish().description }}
    </p>
    }

    <div class="card__footer">
      <div class="card__meta">
        @if (wish().price) {
        <span class="card__price"
          >{{ wish().price | currency:'DKK':'symbol':'1.0-0':locale }}</span
        >
        }
      </div>
      <div class="card__footer-right">
        <span class="card__date"
          >{{ wish().$createdAt | date:'mediumDate':undefined:locale }}</span
        >
        @if (wish().url) {
        <a
          tuiIconButton
          type="button"
          appearance="flat"
          size="s"
          class="card__url-btn"
          [href]="wish().url"
          target="_blank"
          rel="noopener noreferrer"
          (click)="$event.stopPropagation()"
        >
          <tui-icon icon="@tui.external-link" />
        </a>
        } @if (isOwner()) {
        <button
          tuiIconButton
          type="button"
          appearance="flat"
          size="s"
          class="card__delete-btn"
          (click)="onDeleteClick(); $event.stopPropagation()"
        >
          <tui-icon icon="@tui.trash-2" />
        </button>
        }
      </div>
    </div>

    <!-- Reservation actions for non-owners -->
    @if (!isOwner()) {
    <div class="card__actions">
      @if (!isReserved) {
      <button
        tuiButton
        type="button"
        appearance="primary"
        size="s"
        (click)="onReserveClick(); $event.stopPropagation()"
      >
        <tui-icon icon="@tui.gift" class="action-icon"></tui-icon>
        Reserve
      </button>
      } @else if (isReservedByMe()) {
      <button
        tuiButton
        type="button"
        appearance="secondary"
        size="s"
        (click)="onUnreserveClick(); $event.stopPropagation()"
      >
        <tui-icon icon="@tui.x" class="action-icon"></tui-icon>
        Cancel Reservation
      </button>
      } @else {
      <span class="card__reserved-text"> Someone is getting this! </span>
      }
    </div>
    }
  </div>
</div>
